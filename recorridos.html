<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>USIG - Recorridos</title>
	<script type="text/javascript" src="js/libs/jquery-1.7.1.min.js"></script>
	<script src="js/utils.js" type="text/javascript"></script>
	<script src="http://servicios.usig.buenosaires.gob.ar/usig-js/dev/usig.AutoCompleterFull.min.js" type="text/javascript"></script>
	<script src="http://servicios.usig.buenosaires.gob.ar/usig-js/dev/usig.Recorridos.min.js" type="text/javascript"></script>

	<script type="text/javascript">
	    function show_paths(paths) {
	        $(paths).each(function(){
	            var li = $("<li>");
	            var desc = this.toString();
	            desc += ' (tardas ' + this.getTime() + ')';
	            $(li).html(desc);
	            li.appendTo("#paths");
	        });
	    }

        function search_paths(from, to, success, error) {
            var full_results = [];
            var types = ['transporte', 'auto', 'pie'];
            var process_next = function(results) {
                console.log("proceso uno de: " + types);
                console.log(results);
                full_results = full_results.concat(results);
                var type = types.pop();
                if (type) {
                    usig.Recorridos.opts.tipo = type;
                    usig.Recorridos.buscarRecorridos(from, to, process_next);
                } else {
                    success(full_results);
                }
            };
            process_next([]);
        }

	    $(document).ready(function(){
	        var from = getURLParameter('from');
	        var to = getURLParameter('to');
	        $('#legend').text("Vas desde " + from + " hasta " + to);
	        search_paths(
	            new usig.Punto(107577.429171,100133.783044),
	            new usig.Punto(106846.501267,101724.82835),
	            show_paths,
	            function() {
				    alert("error");//$('#recorridos').html('Se produjo un error el buscar el recorrido.');
		        });
	    });
	</script>
  </head>
  <body>
    <span id="legend"></span>
    <ul id="paths">
    </ul>
  </body>
</html>
